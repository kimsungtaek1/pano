name: Deploy to Cafe24 FTP

on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Install lftp
        run: sudo apt-get install -y lftp

      - name: Deploy via FTP
        run: |
          lftp -e "
            set ssl:verify-certificate no;
            set ftp:passive-mode true;
            open ftp://${{ secrets.FTP_USERNAME }}:${{ secrets.FTP_PASSWORD }}@${{ secrets.FTP_HOST }};
            mirror --reverse --only-newer --verbose \
              --exclude .git/ \
              --exclude .env \
              --exclude deploy.sh \
              --exclude README.md \
              --exclude .gitignore \
              --exclude database/ \
              --exclude .github/ \
              --exclude .agent/ \
              --exclude .serena/ \
              --exclude admin/ \
              ./ ${{ secrets.FTP_REMOTE_DIR }};
            bye
          "
